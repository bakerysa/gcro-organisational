var nodes = [{
    id: "organisational",
    group: 0,
    label: "GCRO Organisational",
    level: 1,
    color: "primary0",
  },
  {
    id: "thematic1",
    group: 1,
    label: "Rationalities of Government and Governance",
    level: 2,
    color: "primary1",
  },
  {
    id: "thematic2",
    group: 2,
    label: "Landscapes in Transition",
    level: 2,
    color: "primary2",
  },
  {
    id: "thematic3",
    group: 3,
    label: "Sustainability Transitions",
    level: 2,
    color: "primary3",
  },
  {
    id: "thematic4",
    group: 4,
    label: "Changing Social Fabric",
    level: 2,
    color: "primary4",
  },
  {
    id: "thematic5",
    group: 5,
    label: "New Regional Economies",
    level: 2,
    color: "primary5",
  },
  {
    id: "thematic6",
    group: 6,
    label: "Histories and Futures of the GCR in Comparative Perpective",
    level: 2,
    color: "primary6",
  },
  {
    id: "thematic7",
    group: 7,
    label: "Analytics, Cartographies, Visualisations",
    level: 2,
    color: "primary7",
  },
  {
    id: "project1",
    group: 2,
    label: "Conceiving, producing and managing a neighbourhood",
    level: 3,
    color: "secondary2",
  },
  {
    id: "project2",
    group: 6,
    label: "What is the GCR? (Seoul Biennale)",
    level: 3,
    color: "secondary6",
  },
  {
    id: "project3",
    group: 2,
    label: "Taking streets seriously",
    level: 3,
    color: "secondary2",
  },
  {
    id: "project4",
    group: 4,
    label: "Scale, belonging and exclusion in Gauteng",
    level: 3,
    color: "secondary4",
  },
  {
    id: "project5",
    group: 2,
    label: "Mothers in the City",
    level: 3,
    color: "secondary2",
  },
  {
    id: "project6",
    group: 7,
    label: "Quality of Life Survey",
    level: 3,
    color: "secondary7",
  },
  {
    id: "project7",
    group: 4,
    label: "Social Cohesion Champions",
    level: 3,
    color: "secondary4",
  },
  {
    id: "project8",
    group: 4,
    label: "CoJ Social Cohesion",
    level: 3,
    color: "secondary4",
  },
  {
    id: "project9",
    group: 4,
    label: "Post-apartheid social mixing",
    level: 3,
    color: "secondary4",
  },
  {
    id: "project10",
    group: 2,
    label: "Untangling Transport",
    level: 3,
    color: "secondary2",
  },
  {
    id: "project11",
    group: 3,
    label: "Green Assets and Infastructure",
    level: 3,
    color: "secondary3",
  },
  {
    id: "project12",
    group: 3,
    label: "Just urban sustainability transitions",
    level: 3,
    color: "secondary3",
  },
  {
    id: "project13",
    group: 2,
    label: "Political Economy of Corridors of Freedom",
    level: 3,
    color: "secondary2",
  },
  {
    id: "project14",
    group: 3,
    label: "Governing Pollution",
    level: 3,
    color: "secondary3",
  },
  {
    id: "project15",
    group: 4,
    label: "Poverty and inequality",
    level: 3,
    color: "secondary4",
  },
  {
    id: "project16",
    group: 1,
    label: "State function in infastructure planning",
    level: 3,
    color: "secondary1",
  },
  {
    id: "project17",
    group: 1,
    label: "Ethnographies of the state",
    level: 3,
    color: "secondary1",
  },
  {
    id: "project18",
    group: 3,
    label: "Water security",
    level: 3,
    color: "secondary3",
  },
  {
    id: "project19",
    group: 1,
    label: "Governance Provocations",
    level: 3,
    color: "secondary1",
  },
  {
    id: "project20",
    group: 5,
    label: "Urban space economy",
    level: 3,
    color: "secondary5",
  },
  {
    id: "project21",
    group: 5,
    label: "Firm level survey (with RM)",
    level: 3,
    color: "secondary5",
  },
  {
    id: "project23",
    group: 6,
    label: "Futures of the GCR",
    level: 3,
    color: "secondary6",
  },
  {
    id: "project24",
    group: 3,
    label: "Metabolic flows and infastructure transitions",
    level: 3,
    color: "secondary3",
  },
  {
    id: "project25",
    group: 3,
    label: "Green economy",
    level: 3,
    color: "secondary3",
  },
  {
    id: "project26",
    group: 1,
    label: "City GCR seminar / GCR Citylab",
    level: 3,
    color: "secondary1",
  },
  {
    id: "project27",
    group: 2,
    label: "Gauteng Transport Centre for Excellence",
    level: 3,
    color: "secondary2",
  },
  {
    id: "project28",
    group: 1,
    label: "Tech in Governance Learning Network",
    level: 3,
    color: "secondary1",
  },
  {
    id: "project29",
    group: 5,
    label: "Economic geography of the GCR",
    level: 3,
    color: "secondary5",
  },
  {
    id: "project30",
    group: 5,
    label: "Determinants of real estate demand",
    level: 3,
    color: "secondary5",
  },
  {
    id: "project31",
    group: 5,
    label: "Methods for regional economic analysis",
    level: 3,
    color: "secondary5",
  },
  {
    id: "project32",
    group: 2,
    label: "Qol spatial statistical modelling",
    level: 3,
    color: "secondary2",
  },
  {
    id: "project33",
    group: 5,
    label: "Modernisation and formalisation of township economies",
    level: 3,
    color: "secondary5",
  },
  {
    id: "project34",
    group: 1,
    label: "Street vendors in policy processes",
    level: 3,
    color: "secondary1",
  },
  {
    id: "project35",
    group: 7,
    label: "Geovisual analytics",
    level: 3,
    color: "secondary7",
  },
  {
    id: "project36",
    group: 2,
    label: "Peripheries and rural / urban transitions",
    level: 3,
    color: "secondary2",
  },
  {
    id: "project37",
    group: 2,
    label: "Zones of displaced urbanisation",
    level: 3,
    color: "secondary2",
  },
  {
    id: "project38",
    group: 2,
    label: "Spatial Imaginaries",
    level: 3,
    color: "secondary2",
  },
  {
    id: "project39",
    group: 2,
    label: "Building Gauteng",
    level: 3,
    color: "secondary2",
  },
  {
    id: "project40",
    group: 1,
    label: "Knowledge partnerships for urban futures",
    level: 3,
    color: "secondary1",
  },
  {
    id: "project41",
    group: 3,
    label: "Governance of Pollution in the GCR Occassional paper",
    level: 3,
    color: "secondary3",
  },
  {
    id: "project42",
    group: 7,
    label: "Ward profile viewer",
    level: 3,
    color: "secondary7",
  },
  {
    id: "project43",
    group: 7,
    label: "Data smart GCR",
    level: 3,
    color: "secondary7",
  },
  {
    id: "project44",
    group: 7,
    label: "Qol Viewer",
    level: 3,
    color: "secondary7",
  },
  {
    id: "project46",
    group: 7,
    label: "Caring Cities Barometer",
    level: 3,
    color: "secondary7",
  },
  {
    id: "project47",
    group: 1,
    label: "Metro form of government",
    level: 3,
    color: "secondary1",
  },
  {
    id: "project48",
    group: 5,
    label: "Firm level survey (with GG)",
    level: 3,
    color: "secondary5",
  },
  {
    id: "staff1",
    label: "Aidan Mosselson",
    level: 4,
    color: "staff",
  },
  {
    id: "staff2",
    label: "Alexandra Parker",
    level: 4,
    color: "staff",
  },
  {
    id: "staff3",
    label: "Christian Hamann",
    level: 4,
    color: "staff",
  },
  {
    id: "staff4",
    label: "Christina Culwick",
    level: 4,
    color: "staff",
  },
  {
    id: "staff5",
    label: "Darlington Mushongera",
    level: 4,
    color: "staff",
  },
  {
    id: "staff6",
    label: "Gillian Maree",
    level: 4,
    color: "staff",
  },
  {
    id: "staff7",
    label: "Graeme Gotz",
    level: 3,
    color: "staff",
  },
  {
    id: "staff8",
    label: "Jesse Harber",
    level: 4,
    color: "staff",
  },
  {
    id: "staff9",
    label: "Kate Joseph",
    level: 4,
    color: "staff",
  },
  {
    id: "staff10",
    label: "Koech Cheruiyot",
    level: 4,
    color: "staff",
  },
  {
    id: "staff11",
    label: "Mamokete Matjomane",
    level: 3,
    color: "staff",
  },
  {
    id: "staff12",
    label: "Mncedisi Siteleki",
    level: 4,
    color: "staff",
  },
  {
    id: "staff13",
    label: "Ngaka Mosiane",
    level: 4,
    color: "staff",
  },
  {
    id: "staff14",
    label: "Richard Ballard",
    level: 4,
    color: "staff",
  },
  {
    id: "staff15",
    label: "Rob Moore",
    level: 4,
    color: "staff",
  },
  {
    id: "staff16",
    label: "Samkelisiwe Khanyile",
    level: 4,
    color: "staff",
  },
  {
    id: "staff17",
    label: "Samy Katumba",
    level: 4,
    color: "staff",
  },
  {
    id: "staff18",
    label: "Thembani Mkhize",
    level: 4,
    color: "staff",
  },
]

var links = [{
    target: "organisational",
    source: "thematic1",
    strength: 0.1
  },
  {
    target: "organisational",
    source: "thematic2",
    strength: 0.1
  },
  {
    target: "organisational",
    source: "thematic3",
    strength: 0.1
  },
  {
    target: "organisational",
    source: "thematic4",
    strength: 0.1
  },
  {
    target: "organisational",
    source: "thematic5",
    strength: 0.1
  },
  {
    target: "organisational",
    source: "thematic6",
    strength: 0.1
  },
  {
    target: "organisational",
    source: "thematic7",
    strength: 0.1
  },
  {
    target: "thematic2",
    source: "project1",
    strength: 0.1
  },
  {
    target: "thematic6",
    source: "project2",
    strength: 0.1
  },
  {
    target: "thematic2",
    source: "project3",
    strength: 0.1
  },
  {
    target: "thematic4",
    source: "project4",
    strength: 0.1
  },
  {
    target: "thematic2",
    source: "project5",
    strength: 0.1
  },
  {
    target: "thematic7",
    source: "project6",
    strength: 0.1
  },
  {
    target: "thematic4",
    source: "project7",
    strength: 0.1
  },
  {
    target: "thematic4",
    source: "project8",
    strength: 0.1
  },
  {
    target: "thematic4",
    source: "project9",
    strength: 0.1
  },
  {
    target: "thematic2",
    source: "project10",
    strength: 0.1
  },
  {
    target: "thematic3",
    source: "project11",
    strength: 0.1
  },
  {
    target: "thematic3",
    source: "project12",
    strength: 0.1
  },
  {
    target: "thematic2",
    source: "project13",
    strength: 0.1
  },
  {
    target: "thematic3",
    source: "project14",
    strength: 0.1
  },
  {
    target: "thematic4",
    source: "project15",
    strength: 0.1
  },
  {
    target: "thematic1",
    source: "project16",
    strength: 0.1
  },
  {
    target: "thematic1",
    source: "project17",
    strength: 0.1
  },
  {
    target: "thematic3",
    source: "project18",
    strength: 0.1
  },
  {
    target: "thematic1",
    source: "project19",
    strength: 0.1
  },
  {
    target: "thematic5",
    source: "project20",
    strength: 0.1
  },
  {
    target: "thematic5",
    source: "project21",
    strength: 0.1
  },
  {
    target: "thematic6",
    source: "project23",
    strength: 0.1
  },
  {
    target: "thematic3",
    source: "project24",
    strength: 0.1
  },
  {
    target: "thematic3",
    source: "project25",
    strength: 0.1
  },
  {
    target: "thematic1",
    source: "project26",
    strength: 0.1
  },
  {
    target: "thematic2",
    source: "project27",
    strength: 0.1
  },
  {
    target: "thematic1",
    source: "project28",
    strength: 0.1
  },
  {
    target: "thematic5",
    source: "project29",
    strength: 0.1
  },
  {
    target: "thematic5",
    source: "project30",
    strength: 0.1
  },
  {
    target: "thematic5",
    source: "project31",
    strength: 0.1
  },
  {
    target: "thematic2",
    source: "project32",
    strength: 0.1
  },
  {
    target: "thematic5",
    source: "project33",
    strength: 0.1
  },
  {
    target: "thematic1",
    source: "project34",
    strength: 0.1
  },
  {
    target: "thematic7",
    source: "project35",
    strength: 0.1
  },
  {
    target: "thematic2",
    source: "project36",
    strength: 0.1
  },
  {
    target: "thematic2",
    source: "project37",
    strength: 0.1
  },
  {
    target: "thematic2",
    source: "project38",
    strength: 0.1
  },
  {
    target: "thematic2",
    source: "project39",
    strength: 0.1
  },
  {
    target: "thematic1",
    source: "project40",
    strength: 0.1
  },
  {
    target: "thematic5",
    source: "project41",
    strength: 0.1
  },
  {
    target: "thematic3",
    source: "project42",
    strength: 0.1
  },
  {
    target: "thematic7",
    source: "project43",
    strength: 0.1
  },
  {
    target: "thematic7",
    source: "project44",
    strength: 0.1
  },
  {
    target: "thematic1",
    source: "project46",
    strength: 0.1
  },
  {
    target: "thematic1",
    source: "project47",
    strength: 0.1
  },
  {
    target: "thematic5",
    source: "project48",
    strength: 0.1
  },
  {
    target: "project1",
    source: "staff1",
    strength: 0.1
  },
  {
    target: "project2",
    source: "staff2",
    strength: 0.1
  },
  {
    target: "project3",
    source: "staff2",
    strength: 0.1
  },
  {
    target: "project4",
    source: "staff2",
    strength: 0.1
  },
  {
    target: "project5",
    source: "staff2",
    strength: 0.1
  },
  {
    target: "project6",
    source: "staff2",
    strength: 0.1
  },
  {
    target: "project7",
    source: "staff3",
    strength: 0.1
  },
  {
    target: "project8",
    source: "staff3",
    strength: 0.1
  },
  {
    target: "project9",
    source: "staff3",
    strength: 0.1
  },
  {
    target: "project6",
    source: "staff3",
    strength: 0.1
  },
  {
    target: "project4",
    source: "staff3",
    strength: 0.1
  },
  {
    target: "project2",
    source: "staff3",
    strength: 0.1
  },
  {
    target: "project10",
    source: "staff4",
    strength: 0.1
  },
  {
    target: "project11",
    source: "staff4",
    strength: 0.1
  },
  {
    target: "project12",
    source: "staff4",
    strength: 0.1
  },
  {
    target: "project6",
    source: "staff4",
    strength: 0.1
  },
  {
    target: "project13",
    source: "staff4",
    strength: 0.1
  },
  {
    target: "project14",
    source: "staff4",
    strength: 0.1
  },
  {
    target: "project15",
    source: "staff5",
    strength: 0.1
  },
  {
    target: "project16",
    source: "staff5",
    strength: 0.1
  },
  {
    target: "project17",
    source: "staff5",
    strength: 0.1
  },
  {
    target: "project46",
    source: "staff5",
    strength: 0.1
  },
  {
    target: "project2",
    source: "staff6",
    strength: 0.1
  },
  {
    target: "project18",
    source: "staff6",
    strength: 0.1
  },
  {
    target: "project11",
    source: "staff6",
    strength: 0.1
  },
  {
    target: "project19",
    source: "staff6",
    strength: 0.1
  },
  {
    target: "project3",
    source: "staff6",
    strength: 0.1
  },
  {
    target: "project14",
    source: "staff6",
    strength: 0.1
  },
  {
    target: "project20",
    source: "staff7",
    strength: 0.1
  },
  {
    target: "project21",
    source: "staff7",
    strength: 0.1
  },
  {
    target: "project23",
    source: "staff7",
    strength: 0.1
  },
  {
    target: "project47",
    source: "staff7",
    strength: 0.1
  },
  {
    target: "project24",
    source: "staff7",
    strength: 0.1
  },
  {
    target: "project25",
    source: "staff7",
    strength: 0.1
  },
  {
    target: "project26",
    source: "staff7",
    strength: 0.1
  },
  {
    target: "project6",
    source: "staff7",
    strength: 0.1
  },
  {
    target: "project13",
    source: "staff7",
    strength: 0.1
  },
  {
    target: "project19",
    source: "staff8",
    strength: 0.1
  },
  {
    target: "project3",
    source: "staff8",
    strength: 0.1
  },
  {
    target: "project13",
    source: "staff8",
    strength: 0.1
  },
  {
    target: "project27",
    source: "staff8",
    strength: 0.1
  },
  {
    target: "project28",
    source: "staff8",
    strength: 0.1
  },
  {
    target: "project19",
    source: "staff9",
    strength: 0.1
  },
  {
    target: "project3",
    source: "staff9",
    strength: 0.1
  },
  {
    target: "project4",
    source: "staff9",
    strength: 0.1
  },
  {
    target: "project7",
    source: "staff9",
    strength: 0.1
  },
  {
    target: "project8",
    source: "staff9",
    strength: 0.1
  },
  {
    target: "project29",
    source: "staff10",
    strength: 0.1
  },
  {
    target: "project30",
    source: "staff10",
    strength: 0.1
  },
  {
    target: "project31",
    source: "staff10",
    strength: 0.1
  },
  {
    target: "project32",
    source: "staff10",
    strength: 0.1
  },
  {
    target: "project33",
    source: "staff11",
    strength: 0.1
  },
  {
    target: "project3",
    source: "staff11",
    strength: 0.1
  },
  {
    target: "project34",
    source: "staff11",
    strength: 0.1
  },
  {
    target: "project1",
    source: "staff11",
    strength: 0.1
  },
  {
    target: "project2",
    source: "staff12",
    strength: 0.1
  },
  {
    target: "project35",
    source: "staff12",
    strength: 0.1
  },
  {
    target: "project32",
    source: "staff12",
    strength: 0.1
  },
  {
    target: "project36",
    source: "staff13",
    strength: 0.1
  },
  {
    target: "project37",
    source: "staff13",
    strength: 0.1
  },
  {
    target: "project19",
    source: "staff13",
    strength: 0.1
  },
  {
    target: "project4",
    source: "staff13",
    strength: 0.1
  },
  {
    target: "project2",
    source: "staff13",
    strength: 0.1
  },
  {
    target: "project38",
    source: "staff14",
    strength: 0.1
  },
  {
    target: "project9",
    source: "staff14",
    strength: 0.1
  },
  {
    target: "project39",
    source: "staff14",
    strength: 0.1
  },
  {
    target: "project4",
    source: "staff14",
    strength: 0.1
  },
  {
    target: "project7",
    source: "staff14",
    strength: 0.1
  },
  {
    target: "project8",
    source: "staff14",
    strength: 0.1
  },
  {
    target: "project40",
    source: "staff15",
    strength: 0.1
  },
  {
    target: "project48",
    source: "staff15",
    strength: 0.1
  },
  {
    target: "project11",
    source: "staff16",
    strength: 0.1
  },
  {
    target: "project35",
    source: "staff16",
    strength: 0.1
  },
  {
    target: "project41",
    source: "staff16",
    strength: 0.1
  },
  {
    target: "project2",
    source: "staff16",
    strength: 0.1
  },
  {
    target: "project6",
    source: "staff16",
    strength: 0.1
  },
  {
    target: "project14",
    source: "staff16",
    strength: 0.1
  },
  {
    target: "project42",
    source: "staff17",
    strength: 0.1
  },
  {
    target: "project43",
    source: "staff17",
    strength: 0.1
  },
  {
    target: "project35",
    source: "staff17",
    strength: 0.1
  },
  {
    target: "project44",
    source: "staff17",
    strength: 0.1
  },
  {
    target: "project32",
    source: "staff17",
    strength: 0.1
  },
  {
    target: "project2",
    source: "staff17",
    strength: 0.1
  },
  {
    target: "project1",
    source: "staff18",
    strength: 0.1
  },
  {
    target: "project19",
    source: "staff18",
    strength: 0.1
  },
  {
    target: "project8",
    source: "staff18",
    strength: 0.1
  },
]

function getNeighbors(node) {
  return links.reduce(function (neighbors, link) {
      if (link.target.id === node.id) {
        neighbors.push(link.source.id)
      } else if (link.source.id === node.id) {
        neighbors.push(link.target.id)
      }
      return neighbors
    },
    [node.id]
  )
}

function isNeighborLink(node, link) {
  return link.target.id === node.id || link.source.id === node.id
}


function getNodeColor(node) {
  if (node.color === "primary0") {
    return "#832a2a";
  }
  else if (node.color === "primary1") {
    return "#cc5a31";
  }
  else if (node.color === "primary2") {
    return "#2c7481";
  }
  else if (node.color === "primary3") {
    return "#6e9c73";
  }
  else if (node.color === "primary4") {
    return "#bb2927";
  }
  else if (node.color === "primary5") {
    return "#70555d";
  }
  else if (node.color === "primary6") {
    return "#3e5d92";
  }
  else if (node.color === "primary7") {
    return "#c3a955";
  }
  else if (node.color === "secondary1") {
    return "#ed8a73";
  }
  else if (node.color === "secondary2") {
    return "#7abebf";
  }
  else if (node.color === "secondary3") {
    return "#a3c9a7";
  }
  else if (node.color === "secondary4") {
    return "#f07067";
  }
  else if (node.color === "secondary5") {
    return "#b396a1";
  }
  else if (node.color === "secondary6") {
    return "#6593b8";
  }
  else if (node.color === "secondary7") {
    return "#dec478";
  }
  else if (node.color === "staff") {
    return "#999c99";
  }
}

function getNodeSize(node) {
  if (node.level === 1) {
    return 45;
  }
  else if (node.level === 2) {
    return 35;
  }
  else if (node.level === 3) {
    return 25;
  }
  else if (node.level === 4) {
    return 15;
  }
}

function getLinkColor(node, link) {
  return isNeighborLink(node, link) ? 'white' : 'red'
}

function getTextColor(node, neighbors) {
  return Array.isArray(neighbors) && neighbors.indexOf(node.id) > -1 ? 'red' : 'white'
}

var width = window.innerWidth
var height = window.innerHeight

var svg = d3.select('svg')
svg.attr('width', width).attr('height', height)

// simulation setup with all forces
var linkForce = d3
  .forceLink()
  .id(function (link) { return link.id })
  .strength(function (link) { return link.strength })

var simulation = d3
  .forceSimulation()
  .force('link', linkForce)
  .force('charge', d3.forceManyBody().strength(-120))
  .force('center', d3.forceCenter(width / 2, height / 2))

var dragDrop = d3.drag().on('start', function (node) {
  node.fx = node.x
  node.fy = node.y
}).on('drag', function (node) {
  simulation.alphaTarget(0.7).restart()
  node.fx = d3.event.x
  node.fy = d3.event.y
}).on('end', function (node) {
  if (!d3.event.active) {
    simulation.alphaTarget(0)
  }
  node.fx = null
  node.fy = null
})

function selectNode(selectedNode) {
  var neighbors = getNeighbors(selectedNode)

  // we modify the styles to highlight selected nodes
  nodeElements.attr('fill', function (node) { return getNodeColor(node, neighbors) })
  textElements.attr('fill', function (node) { return getTextColor(node, neighbors) })
  linkElements.attr('stroke', function (link) { return getLinkColor(selectedNode, link) })
}

var linkElements = svg.append("g")
  .attr("class", "links")
  .selectAll("line")
  .data(links)
  .enter().append("line")
    .attr("stroke-width", 1)
	  .attr("stroke", "#9A9C99")

var nodeElements = svg.append("g")
  .attr("class", "nodes")
  .selectAll("circle")
  .data(nodes)
  .enter().append("circle")
    .attr("r", getNodeSize)
    .attr("fill", getNodeColor)
    .call(dragDrop)
    .on('click', selectNode)

var textElements = svg.append("g")
  .attr("class", "texts")
  .selectAll("text")
  .data(nodes)
  .enter().append("text")
    .text(function (node) { return  node.label })
	  .attr("font-size", 12)
	  .attr("dx", 15)
    .attr("dy", 4)
    .style('fill', 'rgba(255,255,255,0.7)')
    .style('font-family', 'Arial')

simulation.nodes(nodes).on('tick', () => {
  nodeElements
    .attr('cx', function (node) { return node.x })
    .attr('cy', function (node) { return node.y })
  textElements
    .attr('x', function (node) { return node.x })
    .attr('y', function (node) { return node.y })
  linkElements
    .attr('x1', function (link) { return link.source.x })
    .attr('y1', function (link) { return link.source.y })
    .attr('x2', function (link) { return link.target.x })
    .attr('y2', function (link) { return link.target.y })
})

simulation.force("link").links(links)
